<!doctype html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="color-scheme" content="dark light" />
    <meta name="description" content="短视频/图集去水印解析预览：视频、封面、音乐、图片一键预览与下载。" />
    <title>{{ title }}</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/static/styles.css" />

    <!-- Optional libs for ZIP download -->
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  </head>
  <body>
    <div class="toastWrap" id="toastWrap"></div>

    <div class="container">
      <div class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <img src="/static/logo.svg" alt="" />
          </div>
          <div style="min-width: 0">
            <h1>短视频 / 图集 解析</h1>
            <p>PC / 手机自适应 · Ctrl/⌘ + Enter 快速解析</p>
          </div>
        </div>
        <div class="actions">
          <button class="btn icon" id="themeBtn" type="button" title="主题：系统 / 深色 / 浅色">◐</button>
          <a class="btn" href="https://github.com/wujunwei928/parse-video-py" target="_blank" rel="noreferrer noopener"
            >GitHub</a
          >
        </div>
      </div>

      <div class="hero">
        <div class="title">
          <div>
            <h2>解析与预览</h2>
            <p class="hint">粘贴分享文案或链接即可解析。</p>
          </div>
        </div>

        <div class="inputWrap">
          <textarea id="shareText" placeholder="粘贴分享文案或 URL（无需删除文案）…"></textarea>
          <div class="row">
            <button class="btn primary" id="parseBtn" type="button">解析</button>
            <button class="btn" id="clearBtn" type="button">清空</button>
            <button class="btn" id="exampleBtn" type="button">填入示例</button>
            <div class="spacer"></div>
            <div class="chip"><span class="mono">Ctrl/⌘ + Enter</span></div>
          </div>
        </div>

        <div class="meta" style="margin-top: 14px">
          <div class="card">
            <div class="row" style="align-items:center">
              <h3 style="margin:0">历史记录</h3>
              <div class="spacer"></div>
              <span class="chip" id="userChip" style="display:none"></span>
              <a class="btn" id="loginBtn" href="/login" style="display:none">登录</a>
              <a class="btn" id="registerBtn" href="/register" style="display:none">注册</a>
              <a class="btn" id="logoutBtn" href="/logout" style="display:none">退出</a>
              <button class="btn" id="historyRefresh" type="button" style="display:none">刷新</button>
            </div>
            <div id="historyList" class="historyList"></div>
            <p class="muted" style="margin-top:10px">提示：未登录不会记录历史；登录后历史记录按账号隔离。</p>
          </div>
        </div>

        <div class="meta" id="resultWrap" style="display: none">
          <div class="grid2">
            <div class="card">
              <h3>解析结果</h3>
              <div class="kv" id="kv"></div>
            </div>

            <div class="card preview">
              <div style="display: flex; align-items: center; justify-content: space-between; gap: 10px">
                <div>
                  <div style="font-weight: 800; font-size: 14px" id="quickTitle"></div>
                  <div class="muted" style="font-size: 12px; margin-top: 4px" id="quickSubtitle"></div>
                </div>
                <div class="tabs" id="tabs">
                  <div class="tab active" id="tabVideo">视频预览</div>
                  <div class="tab" id="tabImages">图集预览</div>
                </div>
              </div>

              <div id="panelVideo"></div>
              <div id="panelImages" style="display: none"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="lightbox" id="lightbox" aria-hidden="true">
      <div class="panel" role="dialog" aria-modal="true">
        <div class="bar">
          <div class="title" id="lbTitle">预览</div>
          <div style="display:flex; gap:10px; align-items:center;">
            <button class="btn" id="lbToggle" type="button" style="display:none">Live</button>
            <button class="btn" id="lbClose" type="button">关闭</button>
          </div>
        </div>
        <div class="stage" id="lbStage">
          <button class="btn icon" id="lbNavPrev" type="button" title="上一张" style="position:absolute; left:14px; top:50%; transform:translateY(-50%);">‹</button>
          <button class="btn icon" id="lbNavNext" type="button" title="下一张" style="position:absolute; right:14px; top:50%; transform:translateY(-50%);">›</button>

          <img id="lbImg" alt="preview" />
          <video id="lbVideo" controls style="display:none; max-width:100%; max-height: calc(100vh - 160px); border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background:#000;"></video>

          <div id="lbActions" style="position:absolute; left:14px; right:14px; bottom:14px; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;">
            <button class="btn mini" id="lbDlImg" type="button">下载图</button>
            <button class="btn mini" id="lbDlLive" type="button" style="display:none">下载Live</button>
          </div>
        </div>
      </div>
    </div>

    <script src="/static/app.js"></script>
  </body>
</html>
